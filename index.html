<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ù†Ø¸Ø§Ù… Ø§Ù„Ø·Ù„Ø¨Ø§Øª</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/@phosphor-icons/web"></script>
  <style>
    body.dark { background-color: #111827; color: white; }
    body.light { background-color: #ffefe5; color: black; }
    select, option {
      background: transparent;
      appearance: none;
      padding: 0.5rem;
    }
  </style>
</head>
<body class="dark">
  <div id="app" class="max-w-7xl mx-auto px-4 py-8"></div>

<script>
let tasks = [];
let editId = null;
let darkMode = true;

try {
  tasks = JSON.parse(localStorage.getItem("tasks") || "[]");
} catch (e) {
  console.error("Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:", e);
  tasks = [];
}

const departments = {
  "ÙƒØ±ÙŠÙŠØªÙ": "#a3e635", "Ø³ÙˆØ´Ø§Ù„ Ù…ÙŠØ¯ÙŠØ§": "#f472b6", "Ù…Ø§Ø±ÙƒØªÙ†Ù‚": "#f87171",
  "ÙƒÙˆØ§Ù„ÙŠØªÙŠ": "#fde047", "Ø§Ù„Ø´Ø±Ø§ÙƒØ§Øª": "#34d399", "Ø³ÙˆÙŠØªØ±": "#60a5fa",
  "Ø§ÙˆØ¨Ø±ÙŠØ´Ù†": "#a78bfa", "Ø®Ø¯Ù…Ø© Ø¹Ù…Ù„Ø§Ø¡": "#fb923c", "ØªÙ‚Ù†ÙŠØ©": "#22d3ee"
};

const statuses = {
  "ØºÙŠØ± Ù…Ù†Ø¬Ø²": "#e74c3c", "Ù…Ù†Ø¬Ø²": "#27ae60", "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¹Ù…Ù„": "#3498db",
  "Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø±Ø¯": "#8e44ad", "Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…Ø­ØªÙˆÙ‰": "#f39c12",
  "Ù…Ø¹Ù„Ù‚": "#6e4d2b", "Ù…Ù„ØºÙŠ": "#000", "Ø§Ù‡Ù…ÙŠØ©": "#2ecc71"
};

function hexToRgba(hex, alpha) {
  try {
    const r = parseInt(hex.slice(1,3), 16);
    const g = parseInt(hex.slice(3,5), 16);
    const b = parseInt(hex.slice(5,7), 16);
    return `rgba(${r}, ${g}, ${b}, ${alpha})`;
  } catch (e) {
    console.error("Ø®Ø·Ø£ ÙÙŠ ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù„ÙˆÙ†:", e);
    return `rgba(0, 0, 0, ${alpha})`;
  }
}

function val(id) {
  const el = document.getElementById(id);
  return el ? el.value || "--" : "--";
}

function renderTaskCard(task, isCompleted = false) {
  const statusColor = statuses[task.status] || "#999";
  const bgColor = darkMode
    ? `linear-gradient(to bottom, ${hexToRgba(statusColor, 0.2)}, #1f2937)`
    : `linear-gradient(to bottom, ${hexToRgba(statusColor, 0.3)}, white)`;

  const opacity = isCompleted ? "opacity-60 grayscale" : "";
  const borderColor = darkMode ? "#4b5563" : "#ccc";
  const textColor = darkMode ? "text-gray-300" : "text-gray-800";

  return `
    <div class="p-6 rounded-2xl border shadow-md transition ${opacity}" style="background: ${bgColor}; border-color: ${borderColor};">
      <div class="flex justify-between items-center mb-4">
        <span class="px-3 py-1 text-xs font-semibold rounded-full" style="background:${departments[task.department] || '#ccc'}; color:#000">${task.department || "ØºÙŠØ± Ù…Ø­Ø¯Ø¯"}</span>
        <select onchange="updateStatus(${task.id}, this.value)" class="text-xs font-bold px-3 py-1 rounded-full bg-transparent ${darkMode ? 'text-white border-white' : 'text-gray-800 border-gray-500'} border">
          ${Object.keys(statuses).map(s => `<option value="${s}" ${s === task.status ? "selected" : ""}>${s}</option>`).join('')}
        </select>
      </div>
      <h2 class="text-lg font-bold mb-2">${task.title || "Ø¨Ø¯ÙˆÙ† Ø¹Ù†ÙˆØ§Ù†"}</h2>
      <div class="space-y-1 text-sm ${textColor}">
        <p>ğŸ‘¤ ${task.requester || "--"}</p>
        <p>ğŸ“ Ø§Ù„Ù…Ù‚Ø§Ø³: ${task.size || "--"}</p>
        <p>ğŸ¨ Ø§Ù„Ù†ÙˆØ¹: ${task.type || "--"}</p>
        <p>ğŸ“… Ø§Ù„ØªØ³Ù„ÙŠÙ…: ${task.deadline || "--"}</p>
        <p>ğŸ”— Ø§Ù„Ø±Ø§Ø¨Ø·: ${task.link ? `<a href="${task.link}" class="text-blue-400 underline">Ø±Ø§Ø¨Ø·</a>` : "--"}</p>
      </div>
      <div class="flex justify-end gap-2 mt-4">
        <button onclick="editTask(${task.id})" class="text-blue-500 text-xl"><i class="ph ph-pencil-simple"></i></button>
        <button onclick="deleteTask(${task.id})" class="text-red-500 text-xl"><i class="ph ph-trash-simple"></i></button>
      </div>
    </div>`;
}

function render() {
  const bg = darkMode ? 'dark' : 'light';
  const input = darkMode ? 'bg-gray-700 text-white' : 'bg-gray-200 text-black';
  document.body.className = bg;

  const activeTasks = tasks.filter(t => t.status !== "Ù…Ù†Ø¬Ø²");
  const doneTasks = tasks.filter(t => t.status === "Ù…Ù†Ø¬Ø²");

  const formFields = [
    { id: "title", label: "Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø·Ù„Ø¨" },
    { id: "requester", label: "Ø§Ø³Ù… ØµØ§Ø­Ø¨ Ø§Ù„Ø·Ù„Ø¨" },
    { id: "type", label: "Ù†ÙˆØ¹ Ø§Ù„Ø·Ù„Ø¨" },
    { id: "size", label: "Ù…Ù‚Ø§Ø³ Ø§Ù„ØªØµÙ…ÙŠÙ…" },
    { id: "link", label: "Ø§Ù„Ø±Ø§Ø¨Ø·" },
    { id: "deadline", label: "ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ù„ÙŠÙ…", type: "date" }
  ];

  const app = document.getElementById("app");
  app.innerHTML = `
    <div class="flex justify-between items-center mb-6">
      <h1 class="text-2xl font-bold">Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h1>
      <button onclick="toggleMode()" class="px-4 py-2 rounded-full bg-[#ef5b0c] text-white">
        ${darkMode ? "Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù†Ù‡Ø§Ø±ÙŠ â˜€ï¸" : "Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ ğŸŒ™"}
      </button>
    </div>

    <div class="p-6 rounded-2xl ${darkMode ? 'bg-gray-800' : 'bg-white'} shadow-md mb-10">
      <h2 class="text-xl font-bold text-[#ef5b0c] mb-6">Ø¥Ø¶Ø§ÙØ© Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯</h2>
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
        ${formFields.map(f => `<input id="${f.id}" placeholder="${f.label}" type="${f.type || 'text'}" class="p-3 rounded-xl ${input} w-full" />`).join('')}
        <select id="department" class="p-3 rounded-xl ${input}">
          ${Object.keys(departments).map(dep => `<option>${dep}</option>`).join('')}
        </select>
        <textarea id="description" rows="2" placeholder="ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨" class="p-3 rounded-xl ${input} col-span-full"></textarea>
      </div>
      <button onclick="addTask()" class="mt-6 w-full bg-[#ef5b0c] py-3 rounded-xl text-white font-bold hover:bg-orange-600">${editId ? "ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø·Ù„Ø¨" : "Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø·Ù„Ø¨"}</button>
    </div>

    <h2 class="text-xl font-bold mb-4">Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù†Ø´Ø·Ø©</h2>
    <div class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-6 mb-10">
      ${activeTasks.map(t => renderTaskCard(t)).join('') || '<p class="col-span-full text-center text-gray-400">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ù†Ø´Ø·Ø©</p>'}
    </div>

    <h2 class="text-xl font-bold mb-4">Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ù†Ø¬Ø²Ø©</h2>
    <div class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-6">
      ${doneTasks.map(t => renderTaskCard(t, true)).join('') || '<p class="col-span-full text-center text-gray-500">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ù…Ù†Ø¬Ø²Ø©</p>'}
    </div>`;
}

function addTask() {
  const task = {
    id: editId ?? Date.now(),
    title: val("title"),
    requester: val("requester"),
    type: val("type"),
    size: val("size"),
    link: val("link"),
    deadline: val("deadline"),
    description: val("description"),
    department: val("department"),
    status: "ØºÙŠØ± Ù…Ù†Ø¬Ø²"
  };
  tasks = editId ? tasks.map(t => t.id === editId ? task : t) : [...tasks, task];
  editId = null;
  localStorage.setItem("tasks", JSON.stringify(tasks));
  render();
}

function deleteTask(id) {
  if (confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø¨ØŸ")) {
    tasks = tasks.filter(t => t.id !== id);
    localStorage.setItem("tasks", JSON.stringify(tasks));
    render();
  }
}

function editTask(id) {
  const task = tasks.find(t => t.id === id);
  if (!task) return;
  Object.keys(task).forEach(k => {
    const el = document.getElementById(k);
    if (el) el.value = task[k];
  });
  editId = id;
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

function updateStatus(id, status) {
  tasks = tasks.map(t => t.id === id ? { ...t, status } : t);
  localStorage.setItem("tasks", JSON.stringify(tasks));
  render();
}

function toggleMode() {
  darkMode = !darkMode;
  render();
}

document.addEventListener("DOMContentLoaded", render);
</script>
</body>
</html>
